name: Guard PRs (CSV only edits)

on:
  pull_request:
    branches: [ main ]

jobs:
  check-files:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Check changed files
        id: changed
        run: |
          git fetch origin main
          CHANGED=$(git diff --name-only origin/main...HEAD)
          echo "changed=$CHANGED" >> $GITHUB_OUTPUT

      - name: Fail if README.md or data/tools.json was modified
        run: |
          if echo "${{ steps.changed.outputs.changed }}" | grep -E '(^README.md$|^data/tools.json$)'; then
            echo "::error::‚ùå You edited README.md or data/tools.json. Please edit ONLY data/tools.csv. These files are auto-generated after merge."
            exit 1
          fi

      - name: Comment on PR if forbidden files changed
        if: failure()
        uses: marocchino/sticky-pull-request-comment@v2
        with:
          header: forbidden-files
          message: |
            üö´ This PR edits **README.md** or **data/tools.json**.  
            Please update **only `data/tools.csv`**.  
            The README and JSON are auto-generated by CI after merge.